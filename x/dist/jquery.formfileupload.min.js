!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.FormFileUpload=t()}(this,function(){var e=function(e,t){"use strict";var n,i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII=",r=0,a={fileNumber:0,requestSize:0},o=this,l=document.querySelector(".js_dropbox"),s=document.querySelector(".js_list"),d=document.querySelector(".js_fileinputs"),u=document.querySelector(".js_form"),c=document.createElement("div"),f=document.createElement("div"),m={errorMessageTimeout:5e3,maxFileSize:3145728,maxFileNumber:3,thumbnailSize:100,maxRequestSize:9437184,fallbackForIE8:!0,fileNameRe:/^[A-Za-z0-9.\-_ ]+$/,invalidFileNameError:"The name of the file has forbidden characters",invalidFileTypeError:"The fileformat is not allowed",maxRequestSizeError:"The requestsize of the files you want to upload is exceeded.",maxFileNumberError:"You can upload 3 files, not more!",maxFileSizeError:"One of the files is too large. the maximum filesize is 3 MB.",unknownFileReaderError:"Unknown Error while loading the file.",acceptedTypes:{"image/png":"PNG-Bild","image/jpeg":"JPEG-Bild","image/gif":"GIF-Bild","image/tiff":"TIFF-Bild","application/pdf":"PDF-Dokument","application/vnd.ms-excel":"Excel-Dokument","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel-Dokument","application/msword":"Word-Dokument","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word-Dokument"}},p=function(e,t,n){var i={};for(var r in t)e&&e.hasOwnProperty(r)?(i[r]=e[r],"function"==typeof i[r]&&(i[r]=i[r].bind(n))):i[r]=t[r];return i},h=p(t,m,o),v=function(e){return/\.xls$/.test(e.name)&&!e.type?"application/vnd.ms-excel":e.type},A=function(e){var t,n=e.size;return n>=1099511627776?(n/=109951162777.6,t="TB"):n>=1073741824?(n/=107374182.4,t="GB"):n>=1048576?(n/=104857.6,t="MB"):n>=1024?(n/=102.4,t="KB"):(n=10*n,t="B"),Math.round(n)/10+" "+t},E=function(){return!!(window.File&&window.FileList&&window.FileReader)},g=function(e){var t=document.createElement("input");return t.type="file",t.className="fileinput",t.name="fileinput-"+e,e+=1,t},F=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():(e.returnValue=!1,!1)},b=function(e){return/^image\//.test(v(e))},S=function(e){a.fileNumber+=1,a.requestSize+=e.size},w=function(e){a.fileNumber-=1,a.requestSize-=e.size},x=function(e){var t=document.createElement("input");return t.type="hidden",t.value=e.data,t.name="file:"+e.file.name,u.appendChild(t),function(){t.parentNode.removeChild(t)}},y=function(e,t,n){var i=document.createElement("span");i.className="remove",n.appendChild(i),s.appendChild(n),i.addEventListener("click",function(){t(a),n.parentNode.removeChild(n),w(e.file)})},N=function(e,t,n){var r=document.createElement("canvas"),a=window.devicePixelRatio,o=document.createElement("span");o.className="thumbnail";var l=new FileReader,s=r.getContext("2d");r.width=n.thumbnailSize*a,r.height=n.thumbnailSize*a,a>1&&(s.webkitBackingStorePixelRatio=a,s.scale(a,a));var d=new Image;d.addEventListener("load",function(){var e=this.height/this.width;r.height=r.width*e,s.drawImage(this,0,0,n.thumbnailSize*a,n.thumbnailSize*e*a)});var u=t.querySelector(".js_name");l.addEventListener("load",function(n){d.src=b(e)?n.target.result:i,o.appendChild(r),t.insertBefore(o,u)}),l.readAsDataURL(e)},z=function(e,t,n){var i=document.createElement("li");return i.className="file",i.innerHTML=['<span class="label js_name name">',e,'</span><span class="label size">',t,'</span><span class="label type">',n,"</span>"].join(""),i},T=function(e,t){return t.acceptedTypes[e]||"unknown filetype"},L=function(e,t){return e.fileNumber>=t.maxFileNumber?!1:!0},B=function(e,t){return e>=t.maxRequestSize?!1:!0},R=function(e,t){return t.acceptedTypes[e]?!0:!1},C=function(e,t){return e.size>t.maxFileSize?!1:!0},k=function(e,t){return t.fileNameRe.test(e.name)?!0:!1},q=function(e){e.innerHTML=""},M=function(e){var t=document.createElement("li");t.className="error",t.innerHTML=e,clearTimeout(n),n=setTimeout(function(){q(c)},h.errorMessageTimeout),c.appendChild(t),u.insertBefore(c,s)},j=function(e,t){if(e&&console.log(e),t){var n=x(t),i=T(v(t.file),h),r=z(t.file.name,A(t.file),i);y(t,n,r),E()&&N(t.file,r,h)}},U=function(e){return L(a,h)?B(a,h)?R(v(e),h)?C(e,h)?k(e,h)?!0:h.invalidFileNameError:h.maxFileSizeError:h.invalidFileTypeError:h.maxRequestSizeError:h.maxFileNumberError};if(this.convertFilesToBase64=function(e){e.every(function(e){var t=new FileReader;return"string"==typeof U(e)?(M(U(e)),!1):(S(e),t.addEventListener("load",function(t){j(null,{data:t.target.result,file:e})}),t.addEventListener("error",function(){j(h.unknownFileReaderError)}),t.readAsDataURL(e),!0)})},this.addSelectedFile=function(){var e=g(r);u.insertBefore(f,l),f.appendChild(e),e.addEventListener("change",function(){q(c);var t=this.files[0],n={file:t},i=function(){w(t,a),e.parentNode.removeChild(e)};if("string"==typeof U(t))M(U(t)),e.parentNode.removeChild(e);else{var r=T(v(t),h),l=z(t.name,r,A(n.file));S(t,a),y(n,i,l),E()&&N(t,l,h),d.appendChild(e)}o.addSelectedFile()})},!E()&&h.fallbackForIE8){f.className="selectbutton js_selectbutton";var D=document.createElement("span");D.innerHTML="Select File",f.appendChild(D),o.addSelectedFile(),l.style.display="none"}l.addEventListener("drop",function(e){F(e);var t=Array.prototype.slice.call(e.dataTransfer.files,0);o.convertFilesToBase64(t),this.classList.toggle("active")}),l.addEventListener("dragenter",function(e){F(e),this.classList.toggle("active")}),l.addEventListener("dragover",function(e){F(e)}),l.addEventListener("dragleave",function(e){F(e),this.classList.toggle("active")})};return $.fn.formFileUpload=function(t){"use strict";return this.each(function(){var n;$.data(this,"formFileUpload")||(n=$.extend({},t,$(this).data()),$.data(this,"formFileUpload",new e(this,n)))})},e});